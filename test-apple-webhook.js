// Test script to send Apple webhook notifications
const fetch = require('node-fetch');

const testNotification = {
    "signedPayload": "eyJhbGciOiJFUzI1NiIsIng1YyI6WyJNSUlCb1RDQ0FVZWdBd0lCQWdJQkFUQUtCZ2dxaGtqT1BRUURBekF4TlM4d0xRWURWUVFEREJaQmNIQWdVM1J2Y21VZ1EyOXVkR1Z1ZENCVGFXZHVhVzVuTVFzd0NRWURWUVFHRXdKVlV6QWVGdzB5TXpBek1UVXhPRFEwTURsYUZ3MHlOREEwTVRReE9EUTBNRGxhTURFeEN6QUpCZ05WQkFZVEFsVlRNUk13RVFZRFZRUUtEQXBCY0hBZ1UzUnZjbVV4RFRBTEJnTlZCQU1NQkZSbGMzUXdXVEFUQmdjcWhrak9QUUlCQmdncWhrak9QUU1CQndOQ0FBUi9wNzNuYUVCQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQWdJQkFqQUtCZ2dxaGtqT1BRUURBd05IQURCRUFpQnF3K3BKdm9NbVljL1FRUUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQWlIRElpYnJhQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUE9PSIsIk1JSUJvVENDQVVlZ0F3SUJBZ0lCQVRBS0JnZ3Foa2pPUFFRREF6QXhOUzh3TFFZRFZRUUREQlpCY0hBZ1UzUnZjbVVnUTI5dWRHVnVkQ0JUYVdkdWFXNW5NUXN3Q1FZRFZRUUdFd0pWVXpBZUZ3MHlNekF6TVRVeE9EUTBNRGxhRncweU5EQTBNVFl4T0RRMk1EbGFNREV4Q3pBSkJnTlZCQVlUQWxWVE1STXdFUVlEVlFRS0RBcEJjSEFnVTNSdmNtVXhEVEFMQmdOVkJBTU1CRlJsYzNRd1dUQVRCZ2NxaGtqT1BRSUJCZ2dxaGtqT1BRTUJCd05DQUFSaTlKVkp4bGlBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBb0lCQWpBS0JnZ3Foa2pPUFFRREF3Tkhbdk5IQURCRUFpQnF3K3BKdm9NbVljL1FRUUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQWlIRElpYnJhQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUE9PSJd"
};

async function testWebhook() {
    try {
        console.log('Testing Apple webhook...');

        const response = await fetch('http://localhost:3001/api/webhooks/apple', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify(testNotification)
        });

        const result = await response.text();
        console.log('Response status:', response.status);
        console.log('Response:', result);

        if (response.ok) {
            console.log('✅ Webhook test successful!');
        } else {
            console.log('❌ Webhook test failed');
        }
    } catch (error) {
        console.error('Error testing webhook:', error);
    }
}

testWebhook();